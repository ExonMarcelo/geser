var oCtrl_MonServices;var oFragments={};sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,n,l){var i;return t.extend("com.exonmarcelo.geser.webapp.controller.MonitorServices",{onInit:function(t){oCtrl_MonServices=this;console.log("init");i=oCtrl_MonServices.getView();i.addEventDelegate({onBeforeShow:e.proxy(function(e){this.onBeforeShow(e)},this)});Utils.fnCreateFilterPanel("SERVICES",oCtrl_MonServices,"itfServices");Utils.fnCreateFilterPanel("EXTERNAL_SERVICES",oCtrl_MonServices,"itfExternalServices")},onBeforeShow:function(e){oComponent.fnToggleButtonsTP(true);oComponent.fnToggleButtonUser(true);oComponent.fnChangeTitleApp("ToolPage.Header.ToolHeader.Title.13")},onAfterRendering:function(){},fnFilter:function(e){var t={title:"Filtros",conditionText:"Filtrar desde BD",conditionIsMandatory:true,content:[new sap.m.Label({text:"DNI"}),new sap.m.Input({value:"",maxLength:8}),new sap.m.Label({text:"Nombre"}),new sap.m.Input({value:"",maxLength:50}),new sap.m.Label({text:"Apellido"}),new sap.m.Input({value:"",maxLength:50})],filterButtonText:"Aplicar",cancelButtonText:"Cancelar",fnLocalFilter:function(){var e=[new n("dni",sap.ui.model.FilterOperator.Contains,t.content[1].getValue()),new n("name",sap.ui.model.FilterOperator.Contains,t.content[3].getValue()),new n("surname",sap.ui.model.FilterOperator.Contains,t.content[5].getValue())];var a=[];for(var l=0;l<e.length;l++){if(e[l].oValue1!=""){a.push(e[l])}}if(a.length>0){var i=new sap.ui.model.Filter(a);var o=oCtrl_MonServices.byId("idTableCustomers").getBinding("items");o.filter(i,false)}console.log("local filter")},fnDBFilter:function(){console.log("DB filter")},fnCancelFilter:function(){console.log("canceled filter")}};Utils.fnCreateDialogFilter(t)},fnCleanFilters:function(){Utils.fnCleanTableFilters(oCtrl_MonServices,"idTableCustomers")},onSettingsTablePersonal:function(e){var t=oCore.getModel("mCatalogs");var a=[{key:"plate",text:oCore.getModel("i18n").getProperty("MonitorServices.Table.Column.2"),duplicate:false},{key:"brand",text:oCore.getModel("i18n").getProperty("MonitorServices.Table.Column.3"),duplicate:true},{key:"cylinder",text:oCore.getModel("i18n").getProperty("MonitorServices.Table.Column.4"),duplicate:true}];var l=[],i=[];for(var o=0;o<a.length;o++){if(!a[o].duplicate){var r=new sap.m.ViewSettingsItem({text:"{mCatalogs>"+a[o].key+"}",key:"{mCatalogs>"+a[o].key+"}"});var s=new sap.m.ViewSettingsFilterItem({text:a[o].text,key:a[o].key,multiSelect:false});s.setModel(t,"mCatalogs");s.bindAggregation("items","mCatalogs>/CUSTOMERS",r);l.push(s)}else{var c=oCore.getModel("mCatalogs").getData().CUSTOMERS;var m=Utils.fnDeleteDupilcateObjects(c,a[o].key);var u=oCore.getModel("mLocalFilters");switch(a[o].key){case"brand":u.getData().BRANDS=m;break;case"cylinder":u.getData().CYLINDERS=m;break}u.refresh();var d=new sap.m.ViewSettingsItem({text:"{mLocalFilters>"+a[o].key+"}",key:"{mLocalFilters>"+a[o].key+"}"});var S=new sap.m.ViewSettingsFilterItem({text:a[o].text,key:a[o].key,multiSelect:false});S.setModel(u,"mLocalFilters");var v="";switch(a[o].key){case"brand":v="mLocalFilters>/BRANDS";break;case"cylinder":v="mLocalFilters>/CYLINDERS";break}S.bindAggregation("items",v,d);l.push(S)}i.push(new sap.m.ViewSettingsItem({text:a[o].text,key:a[o].key}))}if(i.length>0){i[0].setSelected(true)}var p=new sap.m.ViewSettingsDialog({title:Utils.fnReadTranslate("Button.SettingsTable.Text"),filterSearchOperator:"Contains",confirm:function(e){var t=oCtrl_MonServices.byId("idTableCustomers"),a=e.getParameters(),l=t.getBinding("items"),i,o,r=[],s=[];i=a.sortItem.getKey();o=a.sortDescending;r.push(new sap.ui.model.Sorter(i,o));l.sort(r);a.filterItems.forEach(function(e){var t=e.getKey(),a=e.getParent().getKey(),l=new n(a,"EQ",t);s.push(l)});l.filter(s);oCtrl_MonServices.byId("idCounterPersonal").setText("("+l.aIndices.length+")")},sortItems:i,filterItems:l});p.open()},onNewInternalService:function(e){oComponent.fnCleanModel("mCatServiceDetail");var t=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var a={title:Utils.fnReadTranslate("MonitorServices.DialogNewInternalService.Title"),icon:"sap-icon://add-product",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.1")}),new sap.m.Input({value:"{mCatServiceDetail>/name}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.2")}),new sap.m.Input({value:"{mCatServiceDetail>/description}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.3")}),new sap.m.Input({value:"{mCatServiceDetail>/price}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.4")}),new sap.m.Input({value:"{mCatServiceDetail>/approximate_duration}"}).addStyleClass(t)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){var e={sIcon:"SUCCESS",sMessage:"Servicio agregado con éxito.",fnButtonOK:function(){}};Utils.fnShowMessage(e)},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:t};Utils.fnDialogWithSimpleForm(a)},onNewExternalService:function(e){oComponent.fnCleanModel("mCatServiceDetail");var t=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var a={title:Utils.fnReadTranslate("MonitorServices.DialogNewExternalService.Title"),icon:"sap-icon://add-product",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.ExternalServices.Column.1")}),new sap.m.Input({value:"{mCatServiceDetail>/name}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.ExternalServices.Column.2")}),new sap.m.Input({value:"{mCatServiceDetail>/description}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.ExternalServices.Column.3")}),new sap.m.Input({value:"{mCatServiceDetail>/price}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.ExternalServices.Column.4")}),new sap.m.Input({value:"{mCatServiceDetail>/approximate_duration}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.ExternalServices.Column.5")}),new sap.m.Input({value:"{mCatServiceDetail>/category}",showValueHelp:true,valueHelpOnly:true,valueHelpRequest:oCtrl_MonServices.onSelectCategory}).addStyleClass(t)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){var e={sIcon:"SUCCESS",sMessage:"Servicio agregado con éxito.",fnButtonOK:function(){}};Utils.fnShowMessage(e)},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:t};Utils.fnDialogWithSimpleForm(a)},onSelectCategory:function(e){var t=oCore.getModel("mCatalogs");var a=e.getSource();var l=new sap.m.StandardListItem({title:"{mCatalogs>description}"});var i=new sap.m.SelectDialog({noDataText:"{i18n>SelectDialog.noDataText}",title:"{i18n>MonitorServices.SelectDialog.Category.Title}",confirm:function(e){var t=e.getParameter("selectedItem");if(t){var n=e.getParameter("selectedItem").getBindingContext("mCatalogs").getPath();var l=oCore.getModel("mCatalogs").getProperty(n);a.setValue(l.description)}if(!t){a.resetProperty("")}},search:function(e){var t=e.getParameter("value");var a=new n("description",sap.ui.model.FilterOperator.Contains,t);var l=new sap.ui.model.Filter([a]);var i=e.getSource().getBinding("items");i.filter(l,false)}});i.setModel(t,"mCatalogs");i.bindAggregation("items","mCatalogs>/CATEGORIES",l);i.open()},onPressEditInternalService:function(e){var t=e.getSource().getBindingInfo("text").binding.getContext().getPath();var a=oCore.getModel("mCatalogs").getProperty(t);var n=oCore.getModel("mCatServiceDetail");n.setData(a);n.refresh();var l=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var i={title:Utils.fnReadTranslate("ServiceDetail.DialogEditInternalService.Title"),icon:"sap-icon://edit",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.1")}),new sap.m.Input({value:"{mCatServiceDetail>/name}"}).addStyleClass(l),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.2")}),new sap.m.Input({value:"{mCatServiceDetail>/description}"}).addStyleClass(l),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.3")}),new sap.m.Input({value:"{mCatServiceDetail>/price}"}).addStyleClass(l),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.4")}),new sap.m.Input({value:"{mCatServiceDetail>/approximate_duration}"}).addStyleClass(l)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){var e={sIcon:"SUCCESS",sMessage:"Servicio modificado con éxito.",fnButtonOK:function(){}};Utils.fnShowMessage(e)},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:l};Utils.fnDialogWithSimpleForm(i)},onPressEditExternalService:function(e){var t=e.getSource().getBindingInfo("text").binding.getContext().getPath();var a=oCore.getModel("mCatalogs").getProperty(t);var n=oCore.getModel("mCatServiceDetail");n.setData(a);n.refresh();var l=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var i={title:Utils.fnReadTranslate("ServiceDetail.DialogEditExternalService.Title"),icon:"sap-icon://edit",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.1")}),new sap.m.Input({value:"{mCatServiceDetail>/name}"}).addStyleClass(l),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.2")}),new sap.m.Input({value:"{mCatServiceDetail>/description}"}).addStyleClass(l),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.3")}),new sap.m.Input({value:"{mCatServiceDetail>/price}"}).addStyleClass(l),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.InternalServices.Column.4")}),new sap.m.Input({value:"{mCatServiceDetail>/approximate_duration}"}).addStyleClass(l),new sap.m.Label({text:Utils.fnReadTranslate("MonitorServices.Table.ExternalServices.Column.5")}),new sap.m.Input({value:"{mCatServiceDetail>/category}",showValueHelp:true,valueHelpOnly:true,valueHelpRequest:oCtrl_MonServices.onSelectCategory}).addStyleClass(l)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){var e={sIcon:"SUCCESS",sMessage:"Servicio externo modificado con éxito.",fnButtonOK:function(){}};Utils.fnShowMessage(e)},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:l};Utils.fnDialogWithSimpleForm(i)}})});