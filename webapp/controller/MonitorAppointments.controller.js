var oCtrl_MonAppointments;var oFragments={};sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/ActionSheet","sap/m/Button"],function(e,t,n,o,l,a,i){var r;return t.extend("com.exonmarcelo.geser.webapp.controller.MonitorAppointments",{onInit:function(t){oCtrl_MonAppointments=this;console.log("init");r=oCtrl_MonAppointments.getView();r.addEventDelegate({onBeforeShow:e.proxy(function(e){this.onBeforeShow(e)},this)});Utils.fnCreateFilterPanel("APPOINTMENTS",oCtrl_MonAppointments)},onBeforeShow:function(e){oComponent.fnToggleButtonsTP(true);oComponent.fnToggleButtonUser(true);oComponent.fnChangeTitleApp("ToolPage.Header.ToolHeader.Title.9");oCtrl_MonAppointments.fnToggleModeAppointments(true)},onAfterRendering:function(){},onSelectionChangeModeAppointments:function(e){var t=e.getSource().getSelectedKey();if(t=="modePlaCal"){oCtrl_MonAppointments.fnToggleModeAppointments(true)}else{oCtrl_MonAppointments.fnToggleModeAppointments(false)}},fnToggleModeAppointments:function(e){oCtrl_MonAppointments.byId("idPlaCalAppointments").setVisible(e);oCtrl_MonAppointments.byId("idTableAppointments").setVisible(!e)},handleAppointmentSelect:function(e){oCtrl_Main.handleAppointmentSelect(e)},fnFilter:function(e){var t={title:"Filtros",conditionText:"Filtrar desde BD",conditionIsMandatory:true,content:[new sap.m.Label({text:"DNI"}),new sap.m.Input({value:"",maxLength:8}),new sap.m.Label({text:"Nombre"}),new sap.m.Input({value:"",maxLength:50}),new sap.m.Label({text:"Apellido"}),new sap.m.Input({value:"",maxLength:50})],filterButtonText:"Aplicar",cancelButtonText:"Cancelar",fnLocalFilter:function(){var e=[new o("dni",sap.ui.model.FilterOperator.Contains,t.content[1].getValue()),new o("name",sap.ui.model.FilterOperator.Contains,t.content[3].getValue()),new o("surname",sap.ui.model.FilterOperator.Contains,t.content[5].getValue())];var n=[];for(var l=0;l<e.length;l++){if(e[l].oValue1!=""){n.push(e[l])}}if(n.length>0){var a=new sap.ui.model.Filter(n);var i=oCtrl_MonAppointments.byId("idTableCustomers").getBinding("items");i.filter(a,false)}console.log("local filter")},fnDBFilter:function(){console.log("DB filter")},fnCancelFilter:function(){console.log("canceled filter")}};Utils.fnCreateDialogFilter(t)},fnCleanFilters:function(){Utils.fnCleanTableFilters(oCtrl_MonAppointments,"idTableCustomers")},onItemPress:function(e){oCtrl_Main.handleAppointmentSelect(e)},onSettingsTableCustomers:function(e){var t=oCore.getModel("mCatalogs");var n=[{key:"dni",text:oCore.getModel("i18n").getProperty("MonitorAppointments.Table.Column.1"),duplicate:false},{key:"name",text:oCore.getModel("i18n").getProperty("MonitorAppointments.Table.Column.2"),duplicate:true},{key:"surname",text:oCore.getModel("i18n").getProperty("MonitorAppointments.Table.Column.3"),duplicate:true}];var l=[],a=[];for(var i=0;i<n.length;i++){if(!n[i].duplicate){var r=new sap.m.ViewSettingsItem({text:"{mCatalogs>"+n[i].key+"}",key:"{mCatalogs>"+n[i].key+"}"});var s=new sap.m.ViewSettingsFilterItem({text:n[i].text,key:n[i].key,multiSelect:false});s.setModel(t,"mCatalogs");s.bindAggregation("items","mCatalogs>/CUSTOMERS",r);l.push(s)}else{var p=oCore.getModel("mCatalogs").getData().CUSTOMERS;var m=Utils.fnDeleteDupilcateObjects(p,n[i].key);var g=oCore.getModel("mLocalFilters");switch(n[i].key){case"name":g.getData().NAMES=m;break;case"surname":g.getData().SURNAMES=m;break}g.refresh();var u=new sap.m.ViewSettingsItem({text:"{mLocalFilters>"+n[i].key+"}",key:"{mLocalFilters>"+n[i].key+"}"});var c=new sap.m.ViewSettingsFilterItem({text:n[i].text,key:n[i].key,multiSelect:false});c.setModel(g,"mLocalFilters");var d="";switch(n[i].key){case"name":d="mLocalFilters>/NAMES";break;case"surname":d="mLocalFilters>/SURNAMES";break}c.bindAggregation("items",d,u);l.push(c)}a.push(new sap.m.ViewSettingsItem({text:n[i].text,key:n[i].key}))}if(a.length>0){a[0].setSelected(true)}var f=new sap.m.ViewSettingsDialog({title:Utils.fnReadTranslate("Button.SettingsTable.Text"),filterSearchOperator:"Contains",confirm:function(e){var t=oCtrl_MonAppointments.byId("idTableCustomers"),n=e.getParameters(),l=t.getBinding("items"),a,i,r=[],s=[];a=n.sortItem.getKey();i=n.sortDescending;r.push(new sap.ui.model.Sorter(a,i));l.sort(r);n.filterItems.forEach(function(e){var t=e.getKey(),n=e.getParent().getKey(),l=new o(n,"EQ",t);s.push(l)});l.filter(s);oCtrl_MonAppointments.byId("idCounterCustomers").setText("("+l.aIndices.length+")")},sortItems:a,filterItems:l});f.open()}})});