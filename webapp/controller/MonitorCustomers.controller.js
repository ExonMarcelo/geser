var oCtrl_MonCustumers;var oFragments={};sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,o,a,n){var s;return t.extend("com.exonmarcelo.geser.webapp.controller.MonitorCustomers",{onInit:function(t){oCtrl_MonCustumers=this;console.log("init");s=oCtrl_MonCustumers.getView();s.addEventDelegate({onBeforeShow:e.proxy(function(e){this.onBeforeShow(e)},this)});Utils.fnCreateFilterPanel("CUSTOMERS",oCtrl_MonCustumers)},onBeforeShow:function(e){oComponent.fnToggleButtonsTP(true);oComponent.fnToggleButtonUser(true);oComponent.fnChangeTitleApp("ToolPage.Header.ToolHeader.Title.3")},onAfterRendering:function(){},fnFilter:function(e){var t={title:"Filtros",conditionText:"Filtrar desde BD",conditionIsMandatory:true,content:[new sap.m.Label({text:"DNI"}),new sap.m.Input({value:"",maxLength:8}),new sap.m.Label({text:"Nombre"}),new sap.m.Input({value:"",maxLength:50}),new sap.m.Label({text:"Apellido"}),new sap.m.Input({value:"",maxLength:50})],filterButtonText:"Aplicar",cancelButtonText:"Cancelar",fnLocalFilter:function(){var e=[new a("dni",sap.ui.model.FilterOperator.Contains,t.content[1].getValue()),new a("name",sap.ui.model.FilterOperator.Contains,t.content[3].getValue()),new a("surname",sap.ui.model.FilterOperator.Contains,t.content[5].getValue())];var o=[];for(var n=0;n<e.length;n++){if(e[n].oValue1!=""){o.push(e[n])}}if(o.length>0){var s=new sap.ui.model.Filter(o);var r=oCtrl_MonCustumers.byId("idTableCustomers").getBinding("items");r.filter(s,false)}console.log("local filter")},fnDBFilter:function(){console.log("DB filter")},fnCancelFilter:function(){console.log("canceled filter")}};Utils.fnCreateDialogFilter(t)},fnCleanFilters:function(){Utils.fnCleanTableFilters(oCtrl_MonCustumers,"idTableCustomers")},fnNewCustomer:function(){oComponent.fnCleanModel("mCustomerDetail");var e=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";oSettingsForm={title:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Title"),icon:"https://image.flaticon.com/icons/svg/1134/1134821.svg",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Label.1.Text")}),new sap.m.Input({value:"{mCustomerDetail>/dni}",maxLength:8}),new sap.m.Label({text:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Label.2.Text")}),new sap.m.Input({value:"{mCustomerDetail>/name}",maxLength:50}),new sap.m.Label({text:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Label.3.Text")}),new sap.m.Input({value:"{mCustomerDetail>/surname}",maxLength:50}),new sap.m.Label({text:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Label.4.Text")}),new sap.m.ComboBox,new sap.m.Label({text:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Label.5.Text")}),new sap.m.DatePicker({}),new sap.m.Label({text:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Label.6.Text")}),new sap.m.Input({value:"{mCustomerDetail>/email}",maxLength:50}),new sap.m.Label({text:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Label.7.Text")}),new sap.m.Input({value:"{mCustomerDetail>/phone}",maxLength:50}),new sap.m.Label({text:Utils.fnReadTranslate("MonitorCustomers.DialogNewCustomer.Label.8.Text")}),new sap.m.Input({value:"{mCustomerDetail>/mobile_phone}",maxLength:50})],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){var e={sIcon:"SUCCESS",sMessage:Utils.fnReadTranslate("MonitorCustomers.Message.NewCustomer.Success"),fnButtonOK:function(){var e=sap.ui.core.UIComponent.getRouterFor(oCtrl_MonCustumers);e._oConfig.transition="slide";e.navTo("CustomerDetail",{},false);console.log("refresh data")}};Utils.fnShowMessage(e)},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:e};Utils.fnDialogWithSimpleForm(oSettingsForm)},onItemPress:function(e){var t=e.getParameter("listItem").getBindingContext("mCatalogs").sPath;var o=oCore.getModel("mCatalogs").getProperty(t);var a=oCore.getModel("mCustomerDetail");a.setData(o);a.refresh();var n=sap.ui.core.UIComponent.getRouterFor(oCtrl_MonCustumers);n._oConfig.transition="slide";n.navTo("CustomerDetail",{},false)},onSettingsTableCustomers:function(e){var t=oCore.getModel("mCatalogs");var o=[{key:"dni",text:oCore.getModel("i18n").getProperty("MonitorCustomers.Table.Column.1"),duplicate:false},{key:"name",text:oCore.getModel("i18n").getProperty("MonitorCustomers.Table.Column.2"),duplicate:true},{key:"surname",text:oCore.getModel("i18n").getProperty("MonitorCustomers.Table.Column.3"),duplicate:true}];var n=[],s=[];for(var r=0;r<o.length;r++){if(!o[r].duplicate){var l=new sap.m.ViewSettingsItem({text:"{mCatalogs>"+o[r].key+"}",key:"{mCatalogs>"+o[r].key+"}"});var i=new sap.m.ViewSettingsFilterItem({text:o[r].text,key:o[r].key,multiSelect:false});i.setModel(t,"mCatalogs");i.bindAggregation("items","mCatalogs>/CUSTOMERS",l);n.push(i)}else{var m=oCore.getModel("mCatalogs").getData().CUSTOMERS;var u=Utils.fnDeleteDupilcateObjects(m,o[r].key);var C=oCore.getModel("mLocalFilters");switch(o[r].key){case"name":C.getData().NAMES=u;break;case"surname":C.getData().SURNAMES=u;break}C.refresh();var g=new sap.m.ViewSettingsItem({text:"{mLocalFilters>"+o[r].key+"}",key:"{mLocalFilters>"+o[r].key+"}"});var p=new sap.m.ViewSettingsFilterItem({text:o[r].text,key:o[r].key,multiSelect:false});p.setModel(C,"mLocalFilters");var c="";switch(o[r].key){case"name":c="mLocalFilters>/NAMES";break;case"surname":c="mLocalFilters>/SURNAMES";break}p.bindAggregation("items",c,g);n.push(p)}s.push(new sap.m.ViewSettingsItem({text:o[r].text,key:o[r].key}))}if(s.length>0){s[0].setSelected(true)}var f=new sap.m.ViewSettingsDialog({title:Utils.fnReadTranslate("Button.SettingsTable.Text"),filterSearchOperator:"Contains",confirm:function(e){var t=oCtrl_MonCustumers.byId("idTableCustomers"),o=e.getParameters(),n=t.getBinding("items"),s,r,l=[],i=[];s=o.sortItem.getKey();r=o.sortDescending;l.push(new sap.ui.model.Sorter(s,r));n.sort(l);o.filterItems.forEach(function(e){var t=e.getKey(),o=e.getParent().getKey(),n=new a(o,"EQ",t);i.push(n)});n.filter(i);oCtrl_MonCustumers.byId("idCounterCustomers").setText("("+n.aIndices.length+")")},sortItems:s,filterItems:n});f.open()}})});