var oCtrl_Main;sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/ActionSheet","sap/m/Button"],function(e,t,n,a){"use strict";return e.extend("com.exonmarcelo.geser.webapp.controller.Main",{onInit:function(){oCtrl_Main=this;var e=this.getView();var t=oCore.getModel("mUser");t.setData({user:"EMARCELO",name:"Exon",surname:"Marcelo Juarez",full_name:"Exon Marcelo Juarez",role:"MecÃ¡nico",last_session:"21/03/2019 00:24"});t.refresh();Utils.fnCreateFilterPanel("MONITOR_REQUESTS",oCtrl_Main,"itfMonitorRequests");e.addEventDelegate({onBeforeShow:jQuery.proxy(function(e){this.onBeforeShow(e)},this)})},onBeforeShow:function(){oComponent.fnToggleButtonsTP(false);oComponent.fnToggleButtonUser(true);oComponent.fnChangeTitleApp("ToolPage.Header.ToolHeader.Title.1");oCtrl_Main.fn_setDataToAppointments()},fn_setDataToAppointments:function(){var e=[{Appointments:[{start:new Date("03/14/2019 09:00"),end:new Date("03/14/2019 11:00"),title:"Mantenimiento",type:"Type02",tentative:false,time:"1 Hora"},{start:new Date("03/14/2019 09:00"),end:new Date("03/14/2019 11:00"),title:"Cambio de Retenes de Volante",type:"Type02",tentative:false,time:"2 Horas"},{start:new Date("03/14/2019 10:00"),end:new Date("03/14/2019 12:00"),title:"Cambio de Discos de Embrague",type:"Type03",tentative:false,time:"2 Horas"},{start:new Date("03/14/2019 11:00"),end:new Date("03/14/2019 16:00"),title:"Cambio de Anillos",type:"Type02",tentative:false,time:"5 Horas"}]}];oCore.getModel("mMain").getData().PlanningCalendar=e;oCore.getModel("mMain").refresh()},handleAppointmentSelect:function(e){var t=e.getParameter("appointment").getBindingContext("mMonitor").getPath();var n=oCore.getModel("mMonitor").getProperty(t);var a=oCore.getModel("mAppointmentDetail");a.setData(n);a.refresh();var o=new sap.m.Dialog({stretch:sap.ui.Device.system.phone?true:false,title:"{i18n>Main.ServiceAppointments.Dialog.Title}",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:3,labelSpanL:3,labelSpanM:3,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:4,emptySpanL:4,emptySpanM:4,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false,content:[new sap.m.Label({design:"Bold",text:"{i18n>Main.ServiceAppointments.Dialog.Form.Label.1.Text}"}),new sap.m.Text({text:"{mAppointmentDetail>/title}"}),new sap.m.Label({design:"Bold",text:"{i18n>Main.ServiceAppointments.Dialog.Form.Label.2.Text}"}),new sap.m.Text({text:"{mAppointmentDetail>/time}"}),new sap.m.Label({design:"Bold",text:"{i18n>Main.ServiceAppointments.Dialog.Form.Label.3.Text}"}),new sap.m.Text({text:sDateFormat_1.format(a.getProperty("/start"))}),new sap.m.Label({design:"Bold",text:"{i18n>Main.ServiceAppointments.Dialog.Form.Label.4.Text}"}),new sap.m.Text({text:sDateFormat_1.format(a.getProperty("/end"))})]}),new sap.m.Bar({contentRight:[new sap.m.MenuButton({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.MenuButton.Text}",menu:[new sap.m.Menu({items:[new sap.m.MenuItem({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.MenuButton.MenuItem.1.Text}",icon:"sap-icon://edit"}),new sap.m.MenuItem({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.MenuButton.MenuItem.2.Text}",icon:"sap-icon://inspect-down"}),new sap.m.MenuItem({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.MenuButton.MenuItem.3.Text}",icon:"sap-icon://repost"})],itemSelected:function(){o.close()}})]}),new sap.m.Button({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.Button.Text}",press:function(){o.close()}})]})]});o.open()},handlePressMonServ:function(e){var t=e.getParameter("listItem").getBindingContext("mMain").getPath();var n=oCore.getModel("mMain").getProperty(t);var a=oCore.getModel("mMonitoringDetail");a.setData(n);a.refresh();var o=new sap.m.Table({inset:false,columns:[new sap.m.Column({header:new sap.m.Title({text:"{i18n>Main.MonitoringServices.Dialog.Panel.Table.Column.1.Text}"})}),new sap.m.Column({header:new sap.m.Title({text:"{i18n>Main.MonitoringServices.Dialog.Panel.Table.Column.2.Text}"})}),new sap.m.Column({minScreenWidth:"Desktop",demandPopin:true,header:new sap.m.Title({text:"{i18n>Main.MonitoringServices.Dialog.Panel.Table.Column.3.Text}"})})]});var i=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{mMonitoringDetail>status_description}"}),new sap.m.Text({text:"{mMonitoringDetail>date}"}),new sap.m.Text({text:"{mMonitoringDetail>observation}"})]});o.setModel(a,"mMonitoringDetail");o.bindAggregation("items","mMonitoringDetail>/history_stages",i);var s=new sap.m.Dialog({stretch:sap.ui.Device.system.phone?true:false,title:"{i18n>Main.MonitoringServices.Dialog.Title}",content:[new sap.m.VBox({alignItems:"Center",items:[new sap.f.Avatar({src:"{mMonitoringDetail>/img_vehicle}",displaySize:"M",displayShape:"Circle"}),new sap.m.Title({text:"{mMonitoringDetail>/license_plate}"}),new sap.m.Title({text:"{mMonitoringDetail>/service_description}"})]}),new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:3,labelSpanL:3,labelSpanM:3,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:4,emptySpanL:4,emptySpanM:4,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false,content:[new sap.m.Label({design:"Bold",text:"{i18n>Main.MonitoringServices.Dialog.Form.Label.1.Text}"}),new sap.m.Text({text:"{mMonitoringDetail>/owner}"}),new sap.m.Label({design:"Bold",text:"{i18n>Main.MonitoringServices.Dialog.Form.Label.2.Text}"}),new sap.m.Text({text:"{mMonitoringDetail>/start_date}"}),new sap.m.Label({design:"Bold",text:"{i18n>Main.MonitoringServices.Dialog.Form.Label.3.Text}"}),new sap.m.Text({text:"{mMonitoringDetail>/end_date}"})]}),new sap.m.Panel({headerText:"{i18n>Main.MonitoringServices.Dialog.Panel.HeaderText}",expandable:true,expanded:false,content:[o]})],beginButton:new sap.m.Button({text:"{i18n>Main.MonitoringServices.Dialog.Button.1.Text}",press:function(){oCtrl_Main.byId("listMonitoringServices").removeSelections();s.close();s.destroy()}})});s.open()},onSelectTile:function(e){var t=e.getSource().getId().split("--")[1];switch(t){case"stCatalogs":oCtrl_Main.getOwnerComponent().getRouter().navTo("Catalogs");break;default:break}},handleAppointmentSelect:function(e){var t=e.getParameter("listItem")!=undefined?e.getParameter("listItem"):e.getParameter("appointment");var o=t.getBindingContext("mMonitor").getPath();var i=oCore.getModel("mMonitor").getProperty(o);var s=oCore.getModel("mAppointmentDetail");s.setData(i);s.refresh();var l=new sap.m.Dialog({stretch:sap.ui.Device.system.phone?true:false,title:"{i18n>Main.ServiceAppointments.Dialog.Title}",content:[new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanXL:3,labelSpanL:3,labelSpanM:3,labelSpanS:12,adjustLabelSpan:false,emptySpanXL:4,emptySpanL:4,emptySpanM:4,emptySpanS:0,columnsXL:1,columnsL:1,columnsM:1,singleContainerFullSize:false,content:[new sap.m.Label({design:"Bold",text:Utils.fnReadTranslate("MonitorAppointments.DialogDetail.Label.1.Text")}),new sap.m.Text({text:"{mAppointmentDetail>/nro_appointment}"}),new sap.m.Label({design:"Bold",text:Utils.fnReadTranslate("MonitorAppointments.DialogDetail.Label.2.Text")}),new sap.m.Text({text:"{mAppointmentDetail>/plate}"}),new sap.m.Label({design:"Bold",text:Utils.fnReadTranslate("MonitorAppointments.DialogDetail.Label.3.Text")}),new sap.m.Text({text:util.Formatter.listServicesInColumn(i.services)}),new sap.m.Label({design:"Bold",text:Utils.fnReadTranslate("MonitorAppointments.DialogDetail.Label.4.Text")}),new sap.m.Text({text:"{mAppointmentDetail>/start}"}),new sap.m.Label({design:"Bold",text:Utils.fnReadTranslate("MonitorAppointments.DialogDetail.Label.5.Text")}),new sap.m.Text({text:"{mAppointmentDetail>/time}"}),new sap.m.Label({design:"Bold",text:Utils.fnReadTranslate("MonitorAppointments.DialogDetail.Label.6.Text")}),new sap.m.Text({text:"{mAppointmentDetail>/status}"})]})],buttons:[new a({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.MenuButton.Text}",press:function(){var e=new n({title:Utils.fnReadTranslate("Message.SelectOption"),showCancelButton:true,placement:"VerticalPreferredTop",buttons:[new a({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.MenuButton.MenuItem.1.Text}",icon:"sap-icon://edit",press:oCtrl_Main.onPressEditAppointment}),new a({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.MenuButton.MenuItem.3.Text}",icon:"sap-icon://repost",press:oCtrl_Main.onPressPostponeAppointment}),new a({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.MenuButton.MenuItem.2.Text}",icon:"sap-icon://inspect-down",press:oCtrl_Main.onPressCancelAppointment})]});e.openBy(this)}}),new sap.m.Button({text:"{i18n>Main.ServiceAppointments.Dialog.Bar.Button.Text}",press:function(){l.close()}})]});l.open()},onPressEditAppointment:function(e){oComponent.fnCleanModel("mCustomerDetail");var t=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var n={title:Utils.fnReadTranslate("MonitorAppointments.Message.Popup.Edit"),icon:"sap-icon://accelerated",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogEdit.Label.1.Text")}),new sap.m.Text({text:"{mAppointmentDetail>plate}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogEdit.Label.2.Text")}),new sap.m.MultiInput({showValueHelp:true,valueHelpOnly:true,valueHelpRequest:oCtrl_Main.onValueHelpServices}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogEdit.Label.3.Text")}),new sap.m.DateTimePicker({value:"",valueFormat:"dd/MM/yyyy HH:mm",displayFormat:"dd/MM/yyyy HH:mm",change:function(){}}).addStyleClass(t)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:t};Utils.fnDialogWithSimpleForm(n)},onPressCancelAppointment:function(e){Utils.fnShowConfirmationMessage({sMessage:Utils.fnReadTranslate("MonitorAppointments.Alert.CancelAppointment.Message"),fnButtonOK:function(){Utils.fnShowMessage({sIcon:"SUCCESS",sMessage:Utils.fnReadTranslate("MonitorAppointments.Alert.CancelAppointment.Message.Success")})}})},onPressPostponeAppointment:function(e){Utils.fnShowConfirmationMessage({sMessage:Utils.fnReadTranslate("MonitorAppointments.Alert.PostponeAppointment.Message"),fnButtonOK:oCtrl_Main.fnDialogPostponeAppointment})},fnDialogPostponeAppointment:function(){oComponent.fnCleanModel("mCustomerDetail");var e=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var t={title:Utils.fnReadTranslate("MonitorAppointments.Message.Popup.Postpone"),icon:"sap-icon://accelerated",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogPostpone.Label.1.Text")}),new sap.m.Text({text:"{mAppointmentDetail>plate}"}).addStyleClass(e),new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogPostpone.Label.2.Text")}),new sap.m.Text({text:util.Formatter.listServicesInColumn([])}).addStyleClass(e),new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogPostpone.Label.3.Text")}),new sap.m.DateTimePicker({value:"",valueFormat:"dd/MM/yyyy HH:mm",displayFormat:"dd/MM/yyyy HH:mm",change:function(){}}).addStyleClass(e)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){Utils.fnShowMessage({sIcon:"SUCCESS",sMessage:Utils.fnReadTranslate("MonitorAppointments.Alert.PostponeAppointment.Message.Success")})},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:e};Utils.fnDialogWithSimpleForm(t)},fnNewAppointment:function(){oComponent.fnCleanModel("mCustomerDetail");var e=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var t={title:Utils.fnReadTranslate("MonitorAppointments.Message.Popup.New"),icon:"sap-icon://accelerated",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogNew.Label.1.Text")}),new sap.m.Input({showValueHelp:true,valueHelpOnly:true,valueHelpRequest:oCtrl_Main.onSelectVehicle}).addStyleClass(e),new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogNew.Label.2.Text")}),new sap.m.MultiInput({showValueHelp:true,valueHelpOnly:true,valueHelpRequest:oCtrl_Main.onValueHelpServices}).addStyleClass(e),new sap.m.Label({text:Utils.fnReadTranslate("MonitorAppointments.DialogNew.Label.3.Text")}),new sap.m.DateTimePicker({value:"",valueFormat:"dd/MM/yyyy HH:mm",displayFormat:"dd/MM/yyyy HH:mm",change:function(){}}).addStyleClass(e)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:e};Utils.fnDialogWithSimpleForm(t)},onSelectVehicle:function(e){var t=oCore.getModel("mCatalogs");var n=e.getSource();var a=new sap.m.StandardListItem({title:"{mCatalogs>plate}",description:"{mCatalogs>owner}",icon:"{mCatalogs>image}"});var o=new sap.m.SelectDialog({noDataText:"{i18n>SelectDialog.noDataText}",title:"{i18n>MonitorAppointments.SelectDialog.Vehicle.Title}",confirm:function(e){var t=e.getParameter("selectedItem");if(t){var a=e.getParameter("selectedItem").getBindingContext("mCatalogs").getPath();var o=oCore.getModel("mCatalogs").getProperty(a);n.setValue(o.plate)}if(!t){n.resetProperty("")}},search:function(e){var t=e.getParameter("value");var n=new Filter("owner",sap.ui.model.FilterOperator.Contains,t);var a=new Filter("plate",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter([n,a]);var i=e.getSource().getBinding("items");i.filter(o,false)}});o.setModel(t,"mCatalogs");o.bindAggregation("items","mCatalogs>/VEHICLES",a);o.open()},onValueHelpServices:function(e){var t=this;var n=e.getSource();var a=[];var o=new sap.m.List({headerToolbar:new sap.m.Toolbar({content:[new sap.m.SearchField({placeholder:Utils.fnReadTranslate("MonitorAppointments.ValueHelpServices.SearchField.Placeholder"),search:function(e){var t=[];var n=e.getSource().getValue();if(n&&n.length>0){var a=[];a.push(new sap.ui.model.Filter("nombre",sap.ui.model.FilterOperator.Contains,n));a.push(new sap.ui.model.Filter("id_pais",sap.ui.model.FilterOperator.Contains,n));t.push(new sap.ui.model.Filter(a,false))}var i=o.getBinding("items");i.filter(t)},width:"100%"})]}),mode:"MultiSelect",includeItemInSelection:true,growing:true,growingThreshold:10,busyIndicatorDelay:500,enableBusyIndicator:true,items:{path:"mCatalogs>/SERVICES",template:new sap.m.StandardListItem({title:"{mCatalogs>description}",description:"{mCatalogs>duration}",info:"{mCatalogs>price}"})}});o.attachSelectionChange(function(e){var t=e.getParameter("listItem").getBindingContext("mCatalogs");var n=t.getProperty("id");var o=t.getProperty("description");var i=0;if(a.length==0)a.push(new sap.m.Token({key:n,text:o}));else{for(var s=0;s<a.length;s++){if(a[s].getKey()==n){a.splice(s,1);i=0;break}else{i=1}}}if(i==1)a.push(new sap.m.Token({key:n,text:o}))});var i=new sap.m.Dialog({title:Utils.fnReadTranslate("MonitorAppointments.ValueHelpServices.Title"),stretch:sap.ui.Device.system.desktop===true?false:true,content:[o],buttons:[new sap.m.Button({text:Utils.fnReadTranslate("Button.Accept"),press:function(){n.setTokens(a);i.close()}}),new sap.m.Button({text:Utils.fnReadTranslate("Button.Cancel"),press:function(){i.close()}})],afterClose:function(){i.destroy();if(n.getTokens().length>0)n.setValueState("None")},afterOpen:function(){}});i.open();if(n.getTokens().length>0){for(var s=0;s<o.getItems().length;s++){var l=o.getItems()[s];var r=l.getBindingContextPath();var p=oCore.getModel("mCatalogs");var m=p.getProperty(r);for(var u=0;u<n.getTokens().length;u++){if(m.id==n.getTokens()[u].getKey()){o.setSelectedItem(l,true,true)}}}}}})});