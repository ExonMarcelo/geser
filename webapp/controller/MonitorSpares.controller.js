var oCtrl_MonSpares;var oFragments={};sap.ui.define(["jquery.sap.global","sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t,a,n,o){var l;return t.extend("com.exonmarcelo.geser.webapp.controller.MonitorSpares",{onInit:function(t){oCtrl_MonSpares=this;console.log("init");l=oCtrl_MonSpares.getView();l.addEventDelegate({onBeforeShow:e.proxy(function(e){this.onBeforeShow(e)},this)});Utils.fnCreateFilterPanel("SPARES",oCtrl_MonSpares)},onBeforeShow:function(e){oComponent.fnToggleButtonsTP(true);oComponent.fnToggleButtonUser(true);oComponent.fnChangeTitleApp("ToolPage.Header.ToolHeader.Title.14")},onAfterRendering:function(){},fnFilter:function(e){var t={title:"Filtros",conditionText:"Filtrar desde BD",conditionIsMandatory:true,content:[new sap.m.Label({text:"DNI"}),new sap.m.Input({value:"",maxLength:8}),new sap.m.Label({text:"Nombre"}),new sap.m.Input({value:"",maxLength:50}),new sap.m.Label({text:"Apellido"}),new sap.m.Input({value:"",maxLength:50})],filterButtonText:"Aplicar",cancelButtonText:"Cancelar",fnLocalFilter:function(){var e=[new n("dni",sap.ui.model.FilterOperator.Contains,t.content[1].getValue()),new n("name",sap.ui.model.FilterOperator.Contains,t.content[3].getValue()),new n("surname",sap.ui.model.FilterOperator.Contains,t.content[5].getValue())];var a=[];for(var o=0;o<e.length;o++){if(e[o].oValue1!=""){a.push(e[o])}}if(a.length>0){var l=new sap.ui.model.Filter(a);var r=oCtrl_MonSpares.byId("idTableCustomers").getBinding("items");r.filter(l,false)}console.log("local filter")},fnDBFilter:function(){console.log("DB filter")},fnCancelFilter:function(){console.log("canceled filter")}};Utils.fnCreateDialogFilter(t)},fnCleanFilters:function(){Utils.fnCleanTableFilters(oCtrl_MonSpares,"idTableCustomers")},onSettingsTablePersonal:function(e){var t=oCore.getModel("mCatalogs");var a=[{key:"plate",text:oCore.getModel("i18n").getProperty("MonitorSpares.Table.Column.2"),duplicate:false},{key:"brand",text:oCore.getModel("i18n").getProperty("MonitorSpares.Table.Column.3"),duplicate:true},{key:"cylinder",text:oCore.getModel("i18n").getProperty("MonitorSpares.Table.Column.4"),duplicate:true}];var o=[],l=[];for(var r=0;r<a.length;r++){if(!a[r].duplicate){var s=new sap.m.ViewSettingsItem({text:"{mCatalogs>"+a[r].key+"}",key:"{mCatalogs>"+a[r].key+"}"});var i=new sap.m.ViewSettingsFilterItem({text:a[r].text,key:a[r].key,multiSelect:false});i.setModel(t,"mCatalogs");i.bindAggregation("items","mCatalogs>/CUSTOMERS",s);o.push(i)}else{var p=oCore.getModel("mCatalogs").getData().CUSTOMERS;var u=Utils.fnDeleteDupilcateObjects(p,a[r].key);var m=oCore.getModel("mLocalFilters");switch(a[r].key){case"brand":m.getData().BRANDS=u;break;case"cylinder":m.getData().CYLINDERS=u;break}m.refresh();var g=new sap.m.ViewSettingsItem({text:"{mLocalFilters>"+a[r].key+"}",key:"{mLocalFilters>"+a[r].key+"}"});var d=new sap.m.ViewSettingsFilterItem({text:a[r].text,key:a[r].key,multiSelect:false});d.setModel(m,"mLocalFilters");var c="";switch(a[r].key){case"brand":c="mLocalFilters>/BRANDS";break;case"cylinder":c="mLocalFilters>/CYLINDERS";break}d.bindAggregation("items",c,g);o.push(d)}l.push(new sap.m.ViewSettingsItem({text:a[r].text,key:a[r].key}))}if(l.length>0){l[0].setSelected(true)}var S=new sap.m.ViewSettingsDialog({title:Utils.fnReadTranslate("Button.SettingsTable.Text"),filterSearchOperator:"Contains",confirm:function(e){var t=oCtrl_MonSpares.byId("idTableCustomers"),a=e.getParameters(),o=t.getBinding("items"),l,r,s=[],i=[];l=a.sortItem.getKey();r=a.sortDescending;s.push(new sap.ui.model.Sorter(l,r));o.sort(s);a.filterItems.forEach(function(e){var t=e.getKey(),a=e.getParent().getKey(),o=new n(a,"EQ",t);i.push(o)});o.filter(i);oCtrl_MonSpares.byId("idCounterPersonal").setText("("+o.aIndices.length+")")},sortItems:l,filterItems:o});S.open()},onNewSpare:function(e){oComponent.fnCleanModel("mCatSpareDetail");var t=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var a={title:Utils.fnReadTranslate("MonitorSpares.DialogNewSpare.Title"),icon:"sap-icon://add-product",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorSpares.Table.InternalSpares.Column.1")}),new sap.m.Input({value:"{mCatSpareDetail>/name}"}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorSpares.Table.InternalSpares.Column.2")}),new sap.m.Input({value:"{mCatSpareDetail>/brand}",showValueHelp:true,valueHelpOnly:true,valueHelpRequest:oCtrl_MonSpares.onSelectBrand}).addStyleClass(t),new sap.m.Label({text:Utils.fnReadTranslate("MonitorSpares.Table.InternalSpares.Column.3")}),new sap.m.Input({value:"{mCatSpareDetail>/price}"}).addStyleClass(t)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){var e={sIcon:"SUCCESS",sMessage:"Repuesto agregado con éxito.",fnButtonOK:function(){}};Utils.fnShowMessage(e)},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:t};Utils.fnDialogWithSimpleForm(a)},onSelectBrand:function(e){var t=oCore.getModel("mCatalogs");var a=e.getSource();var o=new sap.m.StandardListItem({title:"{mCatalogs>name}"});var l=new sap.m.SelectDialog({noDataText:"{i18n>SelectDialog.noDataText}",title:"{i18n>MonitorSpares.SelectDialog.Brand.Title}",confirm:function(e){var t=e.getParameter("selectedItem");if(t){var n=e.getParameter("selectedItem").getBindingContext("mCatalogs").getPath();var o=oCore.getModel("mCatalogs").getProperty(n);a.setValue(o.name)}if(!t){a.resetProperty("")}},search:function(e){var t=e.getParameter("value");var a=new n("name",sap.ui.model.FilterOperator.Contains,t);var o=new sap.ui.model.Filter([a]);var l=e.getSource().getBinding("items");l.filter(o,false)}});l.setModel(t,"mCatalogs");l.bindAggregation("items","mCatalogs>/BRANDS",o);l.open()},onPressEditSpare:function(e){var t=e.getSource().getBindingInfo("text").binding.getContext().getPath();var a=oCore.getModel("mCatalogs").getProperty(t);var n=oCore.getModel("mCatSpareDetail");n.setData(a);n.refresh();var o=sap.ui.Device.system.desktop?"sapUiSizeCompact":"sapUiSmallMarginBottom";var l={title:Utils.fnReadTranslate("MonitorSpares.DialogEditSpare.Title"),icon:"sap-icon://edit",content:[new sap.m.Label({text:Utils.fnReadTranslate("MonitorSpares.Table.InternalSpares.Column.1")}),new sap.m.Input({value:"{mCatSpareDetail>/name}"}).addStyleClass(o),new sap.m.Label({text:Utils.fnReadTranslate("MonitorSpares.Table.InternalSpares.Column.2")}),new sap.m.Input({value:"{mCatSpareDetail>/brand}",showValueHelp:true,valueHelpOnly:true,valueHelpRequest:oCtrl_MonSpares.onSelectBrand}).addStyleClass(o),new sap.m.Label({text:Utils.fnReadTranslate("MonitorSpares.Table.InternalSpares.Column.3")}),new sap.m.Input({value:"{mCatSpareDetail>/price}"}).addStyleClass(o)],textButtonOK:Utils.fnReadTranslate("Button.Save"),fnButtonOK:function(){var e={sIcon:"SUCCESS",sMessage:"Repuesto modificado con éxito.",fnButtonOK:function(){}};Utils.fnShowMessage(e)},textButtonCancel:Utils.fnReadTranslate("Button.Cancel"),fnButtonCancel:undefined,sClassDialog:o};Utils.fnDialogWithSimpleForm(l)},onPressDeleteSpare:function(e){var t=e.getSource().getParent().getBindingContext("mCatalogs").getPath();var a=oCore.getModel("mCatalogs").getProperty(t);var n={sMessage:"¿Desea eliminar este registro?",fnButtonOK:function(){var e={sIcon:"SUCCESS",sMessage:"Repuesto eliminado con éxito.",fnButtonOK:function(){}};Utils.fnShowMessage(e)},fnButtonNOT:function(){}};Utils.fnShowConfirmationMessage(n)}})});